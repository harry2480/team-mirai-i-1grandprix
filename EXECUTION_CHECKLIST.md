# 🚢 船荷証券電子化コンペ - 最終実行チェックリスト

## 📋 実行前の確認事項

### ✅ 環境設定

- [ ] `.env.local` ファイルを作成済み
- [ ] `POSTGRES_URL` を設定（党首から引き継ぎ）
- [ ] `AI_GATEWAY_API_KEY` を設定（OpenRouter、$50分）
- [ ] 依存関係をインストール済み（`npm install`）

### ✅ データベース接続確認

```powershell
# PostgreSQL接続テスト（党首のスクリプトを使用）
# 接続文字列が正しいか確認
```

### ✅ 仮説の最終確認

`src/config/themes/bill-of-lading.ts` の仮説7個:

1. **効率化への期待** - 貿易手続き時間・コスト削減
2. **セキュリティリスク** - サイバー攻撃・なりすまし懸念
3. **中小企業負担** - システム導入費用・IT人材不足
4. **国際標準** - MLETR準拠、他国互換性
5. **紙文化共存** - 移行期間の二重運用
6. **法的有効性** - 国際紛争時の準拠法
7. **BCP対応** - システム障害時バックアップ

## 🚀 実行コマンド

### バッチ処理（推奨）

```powershell
npm run batch-analyze -- bill-of-lading
```

**使用API**: OpenRouter Gemini ($50分)  
**適用場面**: 全データ対応  
**特徴**: 700Kトークンごとに自動分割、詳細ログ出力

### 自動仮説生成モード（オプション）

```powershell
npm run batch-analyze -- bill-of-lading --auto-hypotheses
```

**差別化ポイント**: データから仮説を自動抽出  
**リスク**: 生成仮説の品質が不安定な可能性  
**推奨**: まず事前定義仮説で実行し、結果を見てから判断

## 📊 実行後の確認

### ✅ レポート品質チェック

- [ ] `reports/` または `logs/` ディレクトリにファイル生成
- [ ] 仮説ごとのセクションが存在
- [ ] 引用に「#セッション番号」が含まれている
- [ ] 数量表現（「多くの参加者が」等）が含まれていない
- [ ] 価値判断（「優れた提案」等）が含まれていない
- [ ] 文字数が 10,000〜20,000 字程度

### ✅ 技術的検証

- [ ] トークン数の推定が正確
- [ ] バッチ分割が適切
- [ ] LLM呼び出しエラーなし
- [ ] メタデータファイルが正しく生成

## 🏆 コンペ提出前の最終確認

### 評価基準との照合

| 評価軸 | チェックポイント |
|--------|-----------------|
| **インサイトの質** | □ 具体的な引用が豊富<br>□ 反論・再反論まで構造化<br>□ テンプレート的でない深い分析 |
| **読みやすさ** | □ エグゼクティブサマリーあり<br>□ Markdown構造化<br>□ 仮説ごとに判定明記 |
| **正確性** | □ 全ての主張に引用<br>□ ハルシネーションなし<br>□ 中立的記述 |
| **技術力** | □ バッチ処理ログあり<br>□ 型安全な実装<br>□ 再現可能な設計 |

### 提出ファイル構成

```
提出物/
├── reports/bill-of-lading_YYYY-MM-DD.md    ← 最終レポート
├── logs/bill-of-lading-xxx/                ← バッチ処理ログ（技術評価用）
│   ├── metadata.json
│   ├── batch-1/
│   ├── batch-2/
│   └── final-report.md
└── src/config/themes/bill-of-lading.ts     ← 仮説定義（参考資料）
```

## 💡 トラブルシューティング

### エラー: `ECONNREFUSED` (データベース接続失敗)

- POSTGRES_URL の接続文字列を確認
- SSL設定が正しいか確認（`?sslmode=require`）

### エラー: `API Key invalid`

- AI_GATEWAY_API_KEY が正しいか確認
- OpenRouterのクレジット残高を確認

### 警告: `Input may exceed context window`

- バッチサイズを調整（TOKENS_PER_BATCH を 500000 に減らす）
- または自動でバッチ分割される（問題なし）

## 🎯 推奨実行フロー

```powershell
# ステップ1: 環境確認
cat .env.local

# ステップ2: 小規模テスト（最初の5セッションのみ等で試す）
# → 党首スクリプトを改造して LIMIT 5 で実行

# ステップ3: 本番実行（全データ）
npm run batch-analyze -- bill-of-lading

# ステップ4: レポート確認
code logs/bill-of-lading-*/final-report.md

# ステップ5: 必要に応じて再実行（仮説調整後）
# → src/config/themes/bill-of-lading.ts を編集
npm run batch-analyze -- bill-of-lading
```

## ✨ 完了

全てのチェック項目をクリアしたら、コンペ提出準備完了です！

**船荷証券電子化法案の分析、頑張ってください！🚢📊**
